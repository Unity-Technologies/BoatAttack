<#/*THIS IS A T4 FILE - see t4_text_templating.md for what it is and how to run codegen*/#>
<#@ assembly name="System.Collections" #>
<#@ assembly name="System.Core" #>
<#@ assembly name="System.Linq" #>
<#@ import namespace="System.Collections.Generic" #>
<#@ import namespace="System.Linq" #>
<#@ output extension=".gen.cs" #>
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------
// Generated by EntityQueryBuilder_With.tt

using Unity.Collections;
using Unity.Collections.LowLevel.Unsafe;

namespace Unity.Entities
{
    public partial struct EntityQueryBuilder
    {
        // ** FLUENT QUERY **

<#
foreach (var (name, count, memberName) in new[] { 
    ( "Any",            5, "m_Any" ), 
    ( "AnyReadOnly",    5, "m_Any" ), 
    ( "None",           5, "m_None" ), 
    ( "All",            5, "m_All" ), 
    ( "AllReadOnly",    5, "m_All" ) 
    }) {
    for (var it = 1; it <= count; ++it) {
#>
        public EntityQueryBuilder With<#=name#><<#=Series("T{0}", it, ", ")#>>()
        {
            ValidateHasNoQuery();
<#      for (var ia = 0; ia < it; ++ia) {#>
            <#=memberName#>.Add(TypeManager.GetTypeIndex<T<#=ia#>>());
<#      }#>
<#          if (name.Equals("Any") || name.Equals("All")) {#>
<#/*This bit-mask craziness toggles the appropriate bit masks on for as writable for a given range of types.*/#>
            <#=memberName#>WritableBitField |= (((1U << (m_<#=name#>.Length)) - 1) ^ ((1U << (m_<#=name#>.Length - <#=it#>)) - 1));
<#          }#>
            return this;
        }

        public EntityQueryBuilder With<#=name#>(<#=Series("ComponentType type{0}", it, ", ")#>)
        {
            ValidateHasNoQuery();
<#      for (var ia = 0; ia < it; ++ia) {#>
            <#=memberName#>.Add(type<#=ia#>.TypeIndex);
<#      }#>
<#          if (name.Equals("Any") || name.Equals("All")) {#>
<#/*This bit-mask craziness toggles the appropriate bit masks on for as writable for a given range of types.*/#>
            <#=memberName#>WritableBitField |= (((1U << (m_<#=name#>.Length)) - 1) ^ ((1U << (m_<#=name#>.Length - <#=it#>)) - 1));
<#          }#>
            return this;
        }

<#}}#>
    }
}
<#+

// misc support utils

static string Series(string formatString, int count, string separator) =>
    string.Join(separator, Enumerable.Range(0, count).Select(i => string.Format(formatString, i)));
#>
